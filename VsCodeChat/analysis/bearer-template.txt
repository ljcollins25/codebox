!e.idToken)throw new Error("The verifyIdToken method requires an ID Token");let t=await this.getFederatedSignonCertsAsync();return await this.verifySignedJwtWithCertsAsync(e.idToken,t.certs,e.audience,this.issuers,e.maxExpiry)}async getTokenInfo(e){let{data:t}=await this.transporter.request({...n.RETRY_CONFIG,method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded",Authorization:`Bearer ${e}`},url:this.endpoints.tokenInfoUrl.toString()}),r=Object.assign({expiry_date:new Date().getTime()+t.expires_in*1e3,scopes:t.scope.split(" ")},t);return delete r.expires_in,delete r.scope,r}getFederatedSignonCerts(e){if(e)this.getFederatedSignonCertsAsync().then(t=>e(null,t.certs,t.res),e);else return this.getFederatedSignonCertsAsync()}async getFederatedSignonCertsAsync(){let e=new Date().getTime(),t=(0,YHe.hasBrowserCrypto)()?WS.JWK:WS.PEM;if(this.certificateExpiry&&e<this.certificateExpiry.getTime()&&this.certificateCacheFormat===t)return{certs:this.certificateCache,format:t};let r,a;switch(t){case WS.PEM:a=this.endpoints.oauth2FederatedSignonPemCertsUrl.toString();break;case WS.JWK:a=this.endpoints.oauth2FederatedSignonJwkCertsUrl.toString();break;default:throw new Error(`Unsupported certificate format ${t}`)}try{r=await this.transporter.request({...n.RETRY_CONFIG,url:a})}catch(d){throw d instanceof Error&&(d.message=`Failed to retrieve verification certificates: ${d.message}`),d}let o=r?r.headers["cache-control"]:void 0,s=-1;if(o){let u=new RegExp("max-age=([0-9]*)").exec(o);u&&u.length===2&&(s=Number(u[1])*1e3)}let c={};switch(t){case WS.PEM:c=r.data;break;case WS.JWK:for(let d of r.data.keys)c[d.kid]=d;break;default:throw new Error(`Unsupported certificate format ${t}`)}let l=new Date;return this.certificateExpiry=s===-1?null:new Date(l.getTime()+s),this.certificateCache=c,this.certificateCacheFormat=t,{certs:c,format:t,res:r}}getIapPublicKeys(e){if(e)this.getIapPublicKeysAsync().then(t=>e(null,t.pubkeys,t.res),e);else return this.getIapPublicKeysAsync()}as
